<!DOCTYPE html>
<html lang="it">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>SammyDoo Jump & Catch</title>

<style>
body {
  margin: 0;
  background: #111;
  color: #fff;
  font-family: Arial, sans-serif;
  text-align: center;
  overflow: hidden;
}

h1 { margin: 10px 0; }

#gameCanvas {
  max-width: 800px;
  width: 100%;
  background: #87CEEB;
  touch-action: none;
}

#ui {
  display: flex;
  justify-content: space-between;
  max-width: 800px;
  margin: auto;
  padding: 5px;
  font-size: 18px;
}

.badge {
  background: rgba(0,0,0,0.6);
  padding: 6px 12px;
  border-radius: 6px;
}
</style>
</head>

<body>

<h1>üê∂ SammyDoo Jump & Catch</h1>

<canvas id="gameCanvas"></canvas>

<div id="ui">
  <div class="badge" id="score">Score: 0</div>
  <div class="badge" id="timer">Time: 120</div>
  <div class="badge" id="status"></div>
</div>

<script>
/* ===================== SETUP ===================== */
const canvas = document.getElementById('gameCanvas');
const ctx = canvas.getContext('2d');

function resize() {
  canvas.width = Math.min(window.innerWidth, 800);
  canvas.height = canvas.width * 0.75;
}
resize();
window.addEventListener('resize', resize);

let score = 0;
let timeLeft = 120;
let gameStarted = true;

/* ===================== PLAYER ===================== */
const player = {
  x: canvas.width / 2,
  y: canvas.height - 80,
  w: 80,
  h: 80,
  vy: 0,
  jumping: false
};

const gravity = 2400;
const jumpPower = -1200;

/* Jump forgiving */
let coyoteTime = 0;
let jumpBuffer = 0;

/* ===================== POWER UPS ===================== */
let scoreMultiplier = 1;
let multiplierTimer = 0;

/* ===================== DIFFICULTY ===================== */
let spawnRate = 1.5;

/* ===================== ITEMS ===================== */
const itemTypes = [
  {name:'Frisbee', pts:10, size:40, speed:220},
  {name:'Ball', pts:8, size:30, speed:250},
  {name:'Stick', pts:5, size:50, speed:200},
  {name:'Star', pts:0, special:'x2'},
  {name:'Bone', pts:0, special:'time'},
  {name:'Bomb', pts:-10, special:'bomb'}
];

let items = [];

/* ===================== INPUT (SIMPLIFIED TOUCH) ===================== */
let touchDir = 0;

canvas.addEventListener('touchstart', e => {
  const x = e.touches[0].clientX;
  touchDir = x < window.innerWidth / 2 ? -1 : 1;
  jumpBuffer = 0.15;
});

canvas.addEventListener('touchend', () => touchDir = 0);

/* Desktop */
document.addEventListener('keydown', e => {
  if (e.code === 'Space') jumpBuffer = 0.15;
  if (e.key === 'ArrowLeft') touchDir = -1;
  if (e.key === 'ArrowRight') touchDir = 1;
});

document.addEventListener('keyup', () => touchDir = 0);

/* ===================== GAME LOOP ===================== */
let lastTime = performance.now();

function loop(t) {
  const dt = Math.min((t - lastTime) / 1000, 0.05);
  lastTime = t;

  update(dt);
  draw();

  requestAnimationFrame(loop);
}

function update(dt) {
  /* Difficulty */
  spawnRate += dt * 0.01;

  /* Player move */
  player.x += touchDir * 350 * dt;
  player.x = Math.max(player.w/2, Math.min(canvas.width - player.w/2, player.x));

  /* Jump logic */
  if (coyoteTime > 0 && jumpBuffer > 0 && !player.jumping) {
    player.vy = jumpPower;
    player.jumping = true;
    jumpBuffer = 0;
  }

  if (player.jumping) {
    player.vy += gravity * dt;
    player.y += player.vy * dt;
    if (player.y >= canvas.height - player.h) {
      player.y = canvas.height - player.h;
      player.jumping = false;
      coyoteTime = 0.1;
    }
  } else {
    coyoteTime -= dt;
  }

  jumpBuffer -= dt;

  /* Items */
  if (Math.random() < spawnRate * dt && items.length < 6) {
    const t = itemTypes[Math.floor(Math.random()*itemTypes.length)];
    items.push({
      type: t,
      x: Math.random()*(canvas.width-40)+20,
      y: -40,
      speed: t.speed || 240
    });
  }

  items.forEach(i => {
    i.y += (i.speed + spawnRate*20) * dt;
    if (Math.abs(i.x - player.x) < 50 && Math.abs(i.y - (player.y+40)) < 50) {
      collect(i);
      i.dead = true;
    }
  });

  items = items.filter(i => !i.dead && i.y < canvas.height+50);

  /* Multiplier */
  if (multiplierTimer > 0) {
    multiplierTimer -= dt;
    if (multiplierTimer <= 0) scoreMultiplier = 1;
  }
}

function collect(i) {
  if (i.type.special === 'x2') {
    scoreMultiplier = 2;
    multiplierTimer = 5;
    document.getElementById('status').textContent = '‚≠ê x2!';
  } else if (i.type.special === 'time') {
    timeLeft += 5;
    document.getElementById('status').textContent = 'ü¶¥ +5s';
  } else if (i.type.special === 'bomb') {
    score = Math.max(0, score - 10);
    document.getElementById('status').textContent = 'üí£ -10';
  } else {
    score += i.type.pts * scoreMultiplier;
  }
  document.getElementById('score').textContent = 'Score: ' + score;
}

/* ===================== DRAW ===================== */
function draw() {
  ctx.clearRect(0,0,canvas.width,canvas.height);

  /* Player */
  ctx.fillStyle = '#fff';
  ctx.fillRect(player.x - player.w/2, player.y, player.w, player.h);

  /* Items */
  ctx.fillStyle = '#FFD700';
  items.forEach(i => {
    ctx.beginPath();
    ctx.arc(i.x, i.y, 20, 0, Math.PI*2);
    ctx.fill();
  });
}

/* ===================== TIMER ===================== */
setInterval(() => {
  timeLeft--;
  document.getElementById('timer').textContent = 'Time: ' + timeLeft;
}, 1000);

requestAnimationFrame(loop);
</script>

</body>
</html>

