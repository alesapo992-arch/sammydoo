<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>SammyDoo - Arcade Deluxe</title>
  <style>
    body { background:#222; color:#fff; font-family:sans-serif; text-align:center; }
    #gameCanvas { display:block; margin: 0 auto; border:2px solid #000; }
    #score, #timer { font-size:20px; margin: 5px; }
    button { margin-top:15px; padding:10px; }
  </style>
</head>
<body>

<h1>üê∂ SammyDoo Arcade Deluxe</h1>
<canvas id="gameCanvas" width="800" height="600"></canvas>
<div id="score">Score: 0</div>
<div id="timer">Time: 120s</div>
<div id="highscore">High Score: 0</div>
<button onclick="location.reload()">Restart</button>

<script>
// Canvas setup
const canvas = document.getElementById('gameCanvas');
const ctx = canvas.getContext('2d');

let score = 0;
let highScore = localStorage.getItem("sammydooHighScore") || 0;
document.getElementById('highscore').textContent = "High Score: " + highScore;

let gameOver = false;
let timeLeft = 120; 
let playerX = canvas.width / 2;
let playerY = canvas.height - 80;
let playerJumping = false;
let jumpY = 0;
let gravity = 3;

// Images
const dogImg = new Image(); dogImg.src = "sam.png";
const bgImg = new Image(); bgImg.src = "park.png";

// Objects list
const OBJECTS = [
  {name:"Frisbee", file:"frisbee.png", points:10, sound:"catch_frisbee.wav", color:"#00BFFF"},
  {name:"Ball", file:"ball.png", points:8, sound:"catch_ball.wav", color:"#FFD700"},
  {name:"Stick", file:"stick.png", points:5, sound:"catch_stick.wav", color:"#8B4513"},
  {name:"Football", file:"football.png", points:15, sound:"catch_football.wav", color:"#FF4500"},
  {name:"Chicken", file:"chicken.png", points:20, sound:"catch_chicken.wav", color:"#FF69B4"},
  {name:"Rope knot", file:"rope.png", points:12, sound:"catch_rope.wav", color:"#ADFF2F"}
];
const objectImages = {};
const objectSounds = {};
OBJECTS.forEach(o => {
  let img = new Image(); img.src = o.file; objectImages[o.name] = img;
  let snd = new Audio(o.sound); snd.volume = 0.8; objectSounds[o.name] = snd;
});

let fallingItems = [];
let particles = [];

// Music background
const bgMusic = new Audio("bg_music.mp3");
bgMusic.loop = true; bgMusic.volume = 0.3;
bgMusic.addEventListener("canplaythrough", () => bgMusic.play().catch(()=>{}));

function fadeOutMusic(){
    let fade = setInterval(()=>{
        if(bgMusic.volume > 0.01){
            bgMusic.volume = Math.max(0, bgMusic.volume - 0.02);
        } else {
            clearInterval(fade);
        }
    }, 100);
}

// Classes
class FallingItem {
  constructor(type){
    this.type = type;
    this.img = objectImages[type.name];
    this.x = Math.random() * (canvas.width - 40) + 20;
    this.y = 0;
    this.size = 40;
    this.speed = 2 + Math.random()*2;
    this.remove = false;
  }
  update(){
    this.y += this.speed;
    // Collision with dog
    if(this.y + this.size >= playerY && this.y < playerY + 40 &&
       this.x > playerX - 40 && this.x < playerX + 40){
        score += this.type.points;
        spawnParticles(this.x, playerY, this.type.color);
        objectSounds[this.type.name].currentTime = 0;
        objectSounds[this.type.name].play().catch(()=>{});
        this.remove = true;
    }
    if(this.y > canvas.height) this.remove = true;
  }
  draw(){
    if(this.img.complete) ctx.drawImage(this.img, this.x - this.size/2, this.y, this.size, this.size);
  }
}

// Particle effect
function spawnParticles(x, y, color){
    for(let i=0;i<15;i++){
        particles.push({
            x, y,
            size: 4,
            color,
            vx: (Math.random()-0.5)*4,
            vy: (Math.random()-0.5)*4,
            life: 20,
            update(){ this.x += this.vx; this.y += this.vy; this.life--; },
            draw(){ ctx.fillStyle = this.color; ctx.fillRect(this.x, this.y, this.size, this.size); }
        });
    }
}

// Spawn object
function spawnItem(){
  if(Math.random() < 0.03 && fallingItems.length < 6){
    const type = OBJECTS[Math.floor(Math.random()*OBJECTS.length)];
    fallingItems.push(new FallingItem(type));
  }
}

function update(){
  if(playerJumping){
    jumpY += gravity;
    playerY -= 15;
    if(jumpY > 20){ playerJumping = false; }
  } else {
    if(playerY < canvas.height - 80) playerY += gravity;
    else playerY = canvas.height - 80;
    jumpY = 0;
  }

  fallingItems.forEach(fi => fi.update());
  fallingItems = fallingItems.filter(fi => !fi.remove);

  particles.forEach(p => p.update());
  particles = particles.filter(p => p.life > 0);

  if(!gameOver){
    spawnItem();
  }
}

function draw(){
  ctx.clearRect(0,0,canvas.width,canvas.height);

  // Background
  if(bgImg.complete) ctx.drawImage(bgImg, 0, 0, canvas.width, canvas.height);
  else { ctx.fillStyle = "#87CEEB"; ctx.fillRect(0,0,canvas.width,canvas.height); }

  // Dog
  if(dogImg.complete) ctx.drawImage(dogImg, playerX - 40, playerY - 40, 80, 80);
  else { ctx.fillStyle = "#444"; ctx.fillRect(playerX - 40, playerY - 40, 80, 80); }

  // Objects
  fallingItems.forEach(fi => fi.draw());

  // Particles
  particles.forEach(p => p.draw());

  // UI
  document.getElementById('score').textContent = "Score: " + score;
  document.getElementById('timer').textContent = "Time: " + timeLeft + "s";

  // Game Over screen
  if(gameOver){
    ctx.fillStyle = `rgba(0,0,0,0.7)`;
    ctx.fillRect(0,0,canvas.width,canvas.height);
    ctx.fillStyle = "white";
    ctx.font = "bold 38px Arial";
    ctx.textAlign = "center";
    ctx.fillText("GAME OVER", canvas.width/2, canvas.height/2 - 20);
    ctx.fillText("Final Score: " + score, canvas.width/2, canvas.height/2 + 20);
    ctx.fillText("High Score: " + highScore, canvas.width/2, canvas.height/2 + 60);
  }
}

function gameLoop(){
  if(!gameOver){
    update();
    draw();
    requestAnimationFrame(gameLoop);
  }
}

function startTimer(){
  const t = setInterval(()=>{
    if(timeLeft > 0){
      timeLeft--;
    } else {
      clearInterval(t);
      endGame();
    }
  }, 1000);
}

function endGame(){
    gameOver = true;
    fadeOutMusic();
    if(score > highScore){
        highScore = score;
        localStorage.setItem("sammydooHighScore", highScore);
    }
    draw();
}

// Controls
document.addEventListener('keydown', e => {
  if(e.key === "ArrowLeft") playerX -= 15;
  if(e.key === "ArrowRight") playerX += 15;
  if(e.key === " " && !playerJumping){
    playerJumping = true;
    jumpY = 0;
  }
});
canvas.addEventListener('mousemove', e=>{
  const rect = canvas.getBoundingClientRect();
  playerX = e.clientX - rect.left;
});
canvas.addEventListener('mousedown', ()=>{
  if(!playerJumping) {
    playerJumping = true;
    jumpY = 0;
  }
});

startTimer();
gameLoop();
</script>

</body>
</html>
