<!DOCTYPE html>
<html lang="it">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1.0,maximum-scale=1.0,user-scalable=no">
<title>SammyDoo ‚Äì Jump & Catch PRO</title>
<style>
/* Stili originali + miglioramenti: pi√π glow, parallax ready, start screen */
body{ margin:0; background:#111; color:#fff; font-family:Arial,sans-serif; text-align:center; overflow:hidden; }
#gameContainer{ max-width:800px; margin:auto; position:relative; }
canvas{ width:100%; aspect-ratio:4/3; background:#87CEEB; touch-action:none; user-select:none; border:2px solid #fff; display:block; }
#ui{ display:flex; justify-content:space-around; padding:6px 12px; flex-wrap:wrap; gap:4px; }
.badge, .itemUI{ background:rgba(0,0,0,.7); padding:8px 12px; border-radius:8px; display:flex; align-items:center; gap:6px; font-size:14px; min-height:32px; box-shadow:0 2px 8px rgba(0,0,0,0.3); }
.itemUI img{ image-rendering:pixelated; border-radius:4px; box-shadow:0 2px 4px rgba(0,0,0,0.3); width:26px; height:26px; }
#healthBarBg{ width:50px; height:10px; background:rgba(0,0,0,0.8); border-radius:5px; overflow:hidden; border:1px solid rgba(255,255,255,0.2); }
#healthBar{ height:100%; background:linear-gradient(90deg, #ff4444 0%, #ffaa44 50%, #44ff44 100%); border-radius:4px; width:100%; transition:width 0.2s ease; box-shadow:0 0 8px rgba(255,255,255,0.5); }
#comboUI{ background:linear-gradient(90deg, #ffaa00, #ffff00); color:#000; font-weight:bold; }
#startScreen, #gameOverScreen{ position:absolute; inset:0; background:rgba(0,0,0,.9); display:flex; flex-direction:column; justify-content:center; align-items:center; z-index:10; backdrop-filter:blur(8px); }
#startScreen h1{ font-size:48px; text-shadow:0 0 30px #4dff4d; margin:0; }
#startScreen p{ font-size:18px; margin:10px 40px; }
#gameOverScreen h2{ font-size:42px; color:#ff4444; text-shadow:0 0 20px #ff4444; }
button{ margin:20px; padding:16px 40px; font-size:22px; background:#4dff4d; color:#000; border:none; border-radius:16px; cursor:pointer; font-weight:bold; box-shadow:0 6px 20px rgba(77,255,77,0.5); transition:transform 0.15s, box-shadow 0.15s; }
button:hover, button:active{ transform:scale(1.08); box-shadow:0 8px 25px rgba(77,255,77,0.7); }
#shareBtn{ background:#1da1f2; color:#fff; margin-top:10px; }
#warning{ position:absolute; top:50%; left:50%; width:80px; height:80px; transform:translate(-50%,-50%); display:none; animation:blink 0.3s infinite; z-index:9; filter:drop-shadow(0 0 25px #ff4444); }
@keyframes blink{ 0%,100%{opacity:1;transform:translate(-50%,-50%) scale(1);} 50%{opacity:0.2;transform:translate(-50%,-50%) scale(1.15);} }
</style>
</head>
<body>
<div id="gameContainer">
  <h1>üê∂ SammyDoo Jump & Catch</h1>
  <img id="warning" src="warning.png">
  <canvas id="gameCanvas"></canvas>
  <div id="ui" style="display:none;">
    <div id="score" class="badge">Score: 0</div>
    <div id="comboUI" class="badge itemUI">Combo: 0</div>
    <div id="frisbeeUI" class="itemUI">üê±‚Äçüíª<span id="frisCount">0</span>/5</div>
    <div id="stickUI" class="itemUI">ü•é<span id="stickCount">0</span>/5</div>
    <div id="ballUI" class="itemUI">‚öΩ<span id="ballCount">0</span>/5</div>
    <div id="health" class="badge">‚ù§Ô∏è<div id="healthBarBg"><div id="healthBar"></div></div></div>
    <div id="high" class="badge">High: 0</div>
  </div>
  <div id="startScreen">
    <h1>üêï SammyDoo!</h1>
    <p>Swipe <strong>sinistra/destra</strong> per muoverti fluido</p>
    <p>Swipe <strong>su</strong> o <strong>tap rapido</strong> per saltare!</p>
    <p>Raccogli giocattoli, evita schifezze! Bonus a 5x</p>
    <button onclick="startGame()">PLAY NOW üê∂</button>
  </div>
  <div id="gameOverScreen" style="display:none;">
    <h2 id="goTitle">GAME OVER</h2>
    <div id="finalScore" style="font-size:24px; margin:20px;">Score: 0</div>
    <button onclick="restartGame()">RESTART üêï</button>
    <button id="shareBtn" onclick="shareScore()">SHARE SCORE üì±</button>
  </div>
</div>
<script>
/* GAME VARS */
const canvas = document.getElementById('gameCanvas'), ctx = canvas.getContext('2d');
const PW=80, PH=80;
let score=0, highScore=+localStorage.getItem('sammyHigh')||0, health=100, gameOver=false, started=false;
let px=0, py=0, vy=0, vx=0, jumping=false, facingRight=true;
let shake=0, combo=0, frisbeeCount=0, stickCount=0, ballCount=0;
let coyoteTime=0.12, jumpBuffer=0;
let items=[], particles=[], trail=[], clouds=[];
let dog=null, dogAnim=0, dogSpawnTimer=0, spawnRate=1.1, difficulty=1;
let magnetTime=0, shieldTime=0;
const GRAVITY=2600, JUMP=-850, ACCEL=800, FRICTION=1200, MAX_VX=500;
const MISS_DMG=15, NEG_DMG=10, BONE_HEAL=25, DOG_DMG=35, COLL_BONUS=50, MAX_COLLECT=5;
let moveDir=0; // -1 left, 1 right
let touchStart={x:0,y:0,time:0}, isDragging=false;

/* AUDIO (stesso) */
const sounds={}; // ... (copia dal tuo: bg, collect, etc. assumi files)
let audioUnlocked=false;
// unlockAudio func same

/* RESIZE */
function resize(){ canvas.width=Math.min(innerWidth,800); canvas.height=canvas.width*0.75; px=canvas.width/2; py=canvas.height-PH; }
resize(); window.addEventListener('resize',resize);

/* SPAWN CLOUDS */
function spawnCloud(){ clouds.push({x:canvas.width+100, y:Math.random()*150+20, vx:30+Math.random()*20, size:Math.random()*40+30}); }
for(let i=0;i<5;i++) spawnCloud();

/* INPUT MIGLIORATO MOBILE */
canvas.addEventListener('touchstart',e=>{e.preventDefault(); started=true; unlockAudio(); startGame(); const t=e.touches[0]; touchStart={x:t.clientX,y:t.clientY,time:Date.now()}; isDragging=true; },{passive:false});
canvas.addEventListener('touchmove',e=>{e.preventDefault(); if(!isDragging) return; const t=e.touches[0]; const dx=t.clientX-touchStart.x; if(Math.abs(dx)>15) moveDir=dx>0?1:-1; },{passive:false});
canvas.addEventListener('touchend',e=>{e.preventDefault(); const t=e.changedTouches[0]; const dx=t.clientX-touchStart.x, dy=t.clientY-touchStart.y; const dist=Math.hypot(dx,dy), time=(Date.now()-touchStart.time)/1000; isDragging=false; moveDir=0;
  if(time<0.4 && dist>20){ if(Math.abs(dy)>Math.abs(dx) && dy<-30){ vy=JUMP*(1+Math.min(dist/200,0.6)); jumping=true; } } else if(time<0.2 && dist<20){ vy=JUMP; jumping=true; } // quick tap
},{passive:false});

// Keys continuous
document.addEventListener('keydown',e=>{ if(e.key=='ArrowLeft' || e.key=='a') moveDir=-1; if(e.key=='ArrowRight'||e.key=='d') moveDir=1; if(e.key=='ArrowUp'||e.key=='w') {jumpBuffer=0.15; coyoteTime=0.12;} });
document.addEventListener('keyup',e=>{ if(e.key=='ArrowLeft'||e.key=='a') if(moveDir==-1) moveDir=0; if(e.key=='ArrowRight'||e.key=='d') if(moveDir==1) moveDir=0; });

/* OBJECTS + POOP */
const ITEM_SCALE=0.75, SPEED_SCALE=0.8;
const OBJECTS=[ /* tuoi + */ {img:'poop.svg dataurl', id:'poop', pts:-20, size:35*ITEM_SCALE, speed:210*SPEED_SCALE, chance:0.12, isPositive:false, explosive:true} ];

/* UPDATE */
function update(dt){
  if(gameOver || !started) return;

  // Movimento fluido
  const targetVx = moveDir * MAX_VX;
  vx += (targetVx - vx) * 12 * dt; // accel smooth
  if(moveDir===0) vx *= Math.pow(0.85, 60*dt); // friction
  px += vx * dt;
  px = Math.max(PW/2, Math.min(canvas.width - PW/2, px));
  facingRight = vx > 5;

  // Jump (stesso + buffer)
  // ... (coyote, buffer same)

  // Difficulty
  spawnRate = 1.2 + score/400 * 0.3;
  difficulty = 1 + score/800 * 0.2;
  if(score % 500 < 50 * dt * 60) health = Math.min(100, health+10); // milestone

  // Magnet
  const magnetStr = magnetTime >0 ? 0.0008 * (400 / magnetTime) : 0;
  magnetTime = Math.max(0, magnetTime-dt);

  // Items update + magnet lerp
  items.forEach(o=>{
    if(magnetStr>0) o.x += (px - o.x) * magnetStr;
    o.y += o.t.speed * difficulty * dt;
    o.rotation += 5 * dt;
    // collect logic same + 
    if(o.t.id==='poop' && collected){ /* explode */ for(let k=0;k<4;k++){ items.push({t:OBJECTS.find(tt=>tt.id=='bucket'), x:o.x+ (k%2?-20:20), y:o.y, rotation:0}); } }
    if(shieldTime>0 && !o.t.isPositive) return; // skip dmg
  });
  shieldTime = Math.max(0,shieldTime-dt);

  // Dog, particles, miss same + combo=0 on miss/neg

  // Trail
  trail.push({x:px, y:py+PH/2, life:1});
  if(trail.length>12) trail.shift();
  trail.forEach(p=> p.life-=dt*4);

  // Clouds parallax
  clouds.forEach(c=>{ c.x -= c.vx * dt; if(c.x < -c.size) {c.x=canvas.width + c.size; c.y=Math.random()*150+20;} });

  // UI update same + document.getElementById('comboUI').textContent=`Combo: ${combo}`;
  if(health<=0) endGame();
}

/* DRAW */
function draw(){
  ctx.save();
  if(shake>0){ const s=Math.sin(Date.now()/50)*shake*15; ctx.translate(s,s*0.6); shake-=0.016; }
  ctx.clearRect(0,0,canvas.width,canvas.height);
  ctx.fillStyle='#87CEEB'; ctx.fillRect(0,0,canvas.width,canvas.height); // bg sky

  // Clouds
  ctx.fillStyle='rgba(255,255,255,0.85)'; ctx.shadowBlur=10; ctx.shadowColor='white';
  clouds.forEach(c=>{
    ctx.beginPath(); ctx.arc(c.x, c.y, c.size/2,0,Math.PI*2); ctx.arc(c.x-20,c.y-10, c.size/3,0,Math.PI*2); ctx.arc(c.x+15,c.y+5,c.size/4,0,Math.PI*2);
    ctx.fill();
  });
  ctx.shadowBlur=0;

  // Trail glow
  trail.slice().reverse().forEach((p,i)=>{
    ctx.save(); ctx.globalAlpha = p.life * 0.6; ctx.shadowColor='#4dff4d'; ctx.shadowBlur=15;
    ctx.fillStyle='#4dff4d'; ctx.beginPath(); ctx.arc(p.x, p.y, 8*(1-p.life)+2,0,Math.PI*2); ctx.fill(); ctx.restore();
  });

  // Player, items, dog, particles same + glow if shield: ctx.shadowColor='#00ff88'; shadowBlur=20;

  ctx.restore();
}

/* POWERUPS in collect */
if(frisbeeCount>=5){ magnetTime=3; frisbeeCount=0; /* particles rainbow */ }
// same for others
if(o.t.special==='health'){ shieldTime=3; /* glow */ }

function startGame(){ document.getElementById('startScreen').style.display='none'; document.getElementById('ui').style.display='flex'; started=true; }
function endGame(){
  gameOver=true; /* audio */
  document.getElementById('finalScore').textContent=`Final: ${Math.floor(score)}`;
  document.getElementById('goTitle').textContent = score > highScore ? 'NEW HIGH! üéâ' : 'GAME OVER';
  document.getElementById('gameOverScreen').style.display='flex';
  highScore=Math.max(highScore,score); localStorage.setItem('sammyHigh',highScore);
}
async function shareScore(){
  if(navigator.share) await navigator.share({title:'SammyDoo Highscore!', text:`Ho fatto ${Math.floor(score)} punti! Prova tu! üê∂`});
}
function restartGame(){ location.reload(); }

/* LOOP */
let lastTime=0;
function loop(t){ const dt=Math.min((t-lastTime)/1000,0.033); lastTime=t; if(started){update(dt); draw();} requestAnimationFrame(loop); }
requestAnimationFrame(loop);
</script>
</body>
</html>
