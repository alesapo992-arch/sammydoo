<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>SammyDoo - Jump & Catch!</title>
  <style>
    body { background:#222; color:#fff; font-family:sans-serif; text-align:center; }
    #gameCanvas { display:block; margin:0 auto; border:2px solid #000; }
    #score, #timer { font-size:20px; margin:5px; }
    button { margin-top:15px; padding:10px; }
  </style>
</head>
<body>

<h1>üê∂ SammyDoo Jump & Catch</h1>
<canvas id="gameCanvas" width="800" height="600"></canvas>
<div id="score">Score: 0</div>
<div id="timer">Time: 120s</div>
<button onclick="location.reload()">Restart</button>

<script>
const canvas = document.getElementById('gameCanvas');
const ctx = canvas.getContext('2d');

// Variabili di gioco
let score = 0;
let timeLeft = 120;
let gameOver = false;
let playerX = canvas.width/2;
let playerY = canvas.height - 80;
let playerJumping = false;
let jumpY = 0;
let gravity = 3;

// Immagini di Sam (corsa e salto)
const dogRunImg = new Image();
dogRunImg.src = "sam_run.png";
const dogJumpImg = new Image();
dogJumpImg.src = "sam_jump.png";

// Sfondo parco
const bgImg = new Image();
bgImg.src = "park.png";

// Oggetti
const OBJECTS = [
  {name:"Frisbee", file:"frisbee.png", points:10},
  {name:"Ball", file:"ball.png", points:8},
  {name:"Stick", file:"stick.png", points:5},
  {name:"Football", file:"football.png", points:15},
  {name:"Chicken", file:"chicken.png", points:20},
  {name:"Rope knot", file:"rope.png", points:12}
];
const objectImages = {};
OBJECTS.forEach(o => {let img=new Image(); img.src=o.file; objectImages[o.name]=img;});

let fallingItems = [];

// Audio
const catchSound = new Audio("catch.wav");
catchSound.volume = 0.7;

// Classe oggetti cadenti (pi√π lenta)
class FallingItem {
  constructor(type){
    this.type = type;
    this.img = objectImages[type.name];
    this.x = Math.random() * (canvas.width - 40) + 20;
    this.y = 0;
    this.size = 40;
    this.speed = 1 + Math.random()*0.5; // pi√π lento
    this.remove = false;
  }
  update(){
    this.y += this.speed;
    // Sam raccoglie SOLO se sta saltando
    if(playerJumping && this.y + this.size >= playerY && this.y < playerY + 40 &&
       this.x > playerX - 40 && this.x < playerX + 40){
        score += this.type.points;
        catchSound.currentTime = 0;
        catchSound.play();
        this.remove = true;
    }
    if(this.y > canvas.height) this.remove = true;
  }
  draw(){
    if(this.img.complete) ctx.drawImage(this.img, this.x - this.size/2, this.y, this.size, this.size);
  }
}

// Spawn oggetti
function spawnItem(){
  if(Math.random() < 0.02 && fallingItems.length < 5){
    const type = OBJECTS[Math.floor(Math.random()*OBJECTS.length)];
    fallingItems.push(new FallingItem(type));
  }
}

function update(){
  if(playerJumping){
    jumpY += gravity;
    playerY -= 15;
    if(jumpY > 20) playerJumping = false;
  } else {
    if(playerY < canvas.height - 80) playerY += gravity;
    else playerY = canvas.height - 80;
    jumpY = 0;
  }

  fallingItems.forEach(fi => fi.update());
  fallingItems = fallingItems.filter(fi => !fi.remove);

  if(!gameOver) spawnItem();
}

function draw(){
  ctx.clearRect(0,0,canvas.width,canvas.height);
  // sfondo
  if(bgImg.complete) ctx.drawImage(bgImg,0,0,canvas.width,canvas.height);
  else { ctx.fillStyle="#87CEEB"; ctx.fillRect(0,0,canvas.width,canvas.height); }

  // Sam animato
  if(playerJumping){
    if(dogJumpImg.complete) ctx.drawImage(dogJumpImg, playerX - 40, playerY - 40, 80, 80);
  } else {
    if(dogRunImg.complete) ctx.drawImage(dogRunImg, playerX - 40, playerY - 40, 80, 80);
  }

  // Oggetti cadenti
  fallingItems.forEach(fi => fi.draw());

  // UI
  document.getElementById('score').textContent = "Score: " + score;
  document.getElementById('timer').textContent = "Time: " + timeLeft + "s";

  // Fine gioco
  if(gameOver){
    ctx.fillStyle="rgba(0,0,0,0.6)";
    ctx.fillRect(0,0,canvas.width,canvas.height);
    ctx.fillStyle="white";
    ctx.font="bold 36px Arial";
    ctx.textAlign="center";
    ctx.fillText("GAME OVER!", canvas.width/2, canvas.height/2);
    ctx.fillText("Final Score: " + score, canvas.width/2, canvas.height/2 + 50);
  }
}

function gameLoop(){
  if(!gameOver){
    update();
    draw();
    requestAnimationFrame(gameLoop);
  }
}

// Timer
function startTimer(){
  const t = setInterval(()=>{
    if(timeLeft > 0){
      timeLeft--;
    } else {
      clearInterval(t);
      gameOver = true;
      draw();
    }
  },1000);
}

// Controlli
document.addEventListener('keydown', e=>{
  if(e.key === "ArrowLeft") playerX -= 15;
  if(e.key === "ArrowRight") playerX += 15;
  if(e.key === " " && !playerJumping){
    playerJumping = true;
    jumpY = 0;
  }
});
canvas.addEventListener('mousemove', e=>{
  const rect = canvas.getBoundingClientRect();
  playerX = e.clientX - rect.left;
});
canvas.addEventListener('mousedown', ()=>{
  if(!playerJumping){
    playerJumping = true;
    jumpY = 0;
  }
});

startTimer();
gameLoop();
</script>

</body>
</html>

</body>
</html>
